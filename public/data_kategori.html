<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Obatln | Home</title>
  <link rel="icon" href="img/Logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
   tailwind.config = {
    theme: {
     extend: {
      colors: {
       primary: "#6dc1ec",
       "primary-hover": "#4aaedb",
       secondary: "#ffffff",
       third: "#000000",
       priback: "#C6E9FC",
      },
      fontFamily: {
       jakarta: ["'Plus Jakarta Sans'", "sans-serif"],
      },
     },
    },
   };
  </script>
  <link
   href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap"
   rel="stylesheet"
  />
  <link
   rel="stylesheet"
   href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
 </head>
 <body class="flex flex-col h-full overflow-x-hidden text-sm">
  <!-- header mobile -->
  <header
   class="fixed top-0 left-0 w-full z-1 flex items-center justify-between px-4 py-4 bg-white shadow-md"
  >
   <!-- Logo -->
   <div class="flex items-center text-xl md:hidden">
    <span class="text-primary font-semibold">Obatln</span>
   </div>

   <!-- Menu dashboard mobile -->
   <button class="md:hidden text-third" id="menuDashboard">
    <i class="fas fa-bars text-xl"></i>
   </button>
  </header>

  <!-- header Desktop -->
  <header
   class="fixed hidden md:flex top-0 left-0 w-full z-1 flex items-center justify-end px-4 py-4 bg-white shadow-md"
  >
   <div class="flex items-center justify-center mr-3">
    <a href="profile.html"
     ><button class="text-primary hover:text-primary-hover transition">
      <i class="fas fa-user text-lg md:text-xl"></i>
      <span class="hidden md:inline-block ml-1 font-semibold">Profile</span>
     </button></a
    >
   </div>
  </header>

  <!-- Dasboard -->
  <div
   class="hidden md:flex fixed left-0 z-100 h-screen top-0 bg-primary text-white w-60 md:w-50 flex flex-col items-center md:items-start py-4 px-2 space-y-6"
   id="dashboard"
  >
   <!-- Navbar -->
   <div class="text-xl flex items-center justify-center w-full">
    <span class="text-2xl font-jakarta">Obatln</span>
   </div>

   <nav class="w-full">
    <a
     href="dashboard.html"
     class="flex items-center mt-4 space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
    >
     <i class="fas fa-home text-secondary"></i>
     <span class="font-jakarta text-secondary">Dashboard</span>
    </a>
   </nav>

   <div class="w-full border-t-2 border-secondary pt-4">
    <div class="mb-2">Master Data</div>
    <nav class="w-full">
     <div class="w-full">
      <a
       href="data_kategori.html"
       class="flex items-center space-x-2 p-2 bg-secondary transition rounded-md w-full"
      >
       <i class="fas fa-tags text-primary"></i>
       <span class="font-jakarta text-primary">Data Kategori</span>
      </a>
      <a
       href="data_obat.html"
       class="flex items-center space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
      >
       <i class="fas fa-pills"></i>
       <span class="font-jakarta">Data Obat</span>
      </a>
      <a
       href="data_supplier.html"
       class="flex items-center space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
      >
       <i class="fas fa-user-tie"></i>
       <span class="font-jakarta">Data Supplier</span>
      </a>
     </div>
    </nav>
   </div>

   <div class="w-full border-t-2 border-secondary pt-4">
    <div class="mb-2">Master Transaksi</div>
    <nav class="w-full">
     <div class="w-full">
      <a
       href="data_pembelian.html"
       class="flex items-center space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
      >
       <i class="fas fa-arrow-circle-up"></i>
       <span class="font-jakarta">Data Pembelian</span>
      </a>
      <a
       href="data_pengeluaran.html"
       class="flex items-center space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
      >
       <i class="fas fa-arrow-circle-down"></i>
       <span class="font-jakarta">Data Pengeluaran</span>
      </a>
     </div>
    </nav>
   </div>

   <div class="w-full border-t-2 border-secondary pt-4">
    <div class="mb-2">Master Pegawai</div>
    <nav class="w-full">
     <div class="space-y-2 w-full">
      <a
       href="data_pegawai.html"
       class="flex items-center space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
      >
       <i class="fas fa-receipt"></i>
       <span class="font-jakarta">Data Pegawai</span>
      </a>
     </div>
    </nav>
   </div>

   <nav class="w-full">
    <a
     href="signin.html"
     class="flex items-center mt-4 space-x-2 p-2 bg-primary hover:bg-primary-hover transition rounded-md w-full"
    >
     <i class="fas fa-sign-out-alt text-secondary"></i>
     <span class="font-jakarta text-secondary">Sign Out</span>
    </a>
   </nav>
  </div>

  <!-- Dasboard mobile-->
  <div
   class="fixed right-0 top-[60px] h-screen w-2/5 bg-primary text-white flex flex-col px-2 py-4 space-y-0 overflow-y-auto translate-x-full transition-transform duration-300 ease-in-out"
   id="mobileDashboard"
  >
   <main class="overflow-y-auto min-h-calc(100vh - 60px)">
    <div class="flex items-center justify-center space-x-2 px-2">
     <a href="profile.html"
      ><button
       class="flex items-center space-x-2 text-secondary hover:text-primary-hover transition p-2 rounded-md"
      >
       <i class="fas fa-user text-lg"></i>
       <span class="font-jakarta font-semibold">Profile</span>
      </button></a
     >
    </div>

    <nav class="w-full mt-4">
     <a
      href="dashboard.html"
      class="flex items-center space-x-2 p-2 hover:bg-primary-hover text-secondary transition rounded-md w-full"
     >
      <i class="fas fa-home"></i>
      <span class="font-jakarta">Dashboard</span>
     </a>
    </nav>

    <div class="w-full border-t-2 border-secondary pt-4 mt-4">
     <div class="mb-2">Master Data</div>
     <nav class="w-full">
      <div class="w-full">
       <a
        href="data_kategori.html"
        class="flex items-center space-x-2 p-2 bg-secondary text-primary transition rounded-md w-full"
       >
        <i class="fas fa-tags"></i>
        <span class="font-jakarta">Data Kategori</span>
       </a>
       <a
        href="data_obat.html"
        class="flex items-center space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
       >
        <i class="fas fa-pills"></i>
        <span class="font-jakarta">Data Obat</span>
       </a>
       <a
        href="data_supplier.html"
        class="flex items-center space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
       >
        <i class="fas fa-user-tie"></i>
        <span class="font-jakarta">Data Supplier</span>
       </a>
      </div>
     </nav>
    </div>

    <div class="w-full border-t-2 border-secondary pt-4 mt-4">
     <div class="mb-2">Master Transaksi</div>
     <nav class="w-full">
      <div class="w-full">
       <a
        href="data_pembelian.html"
        class="flex items-center space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
       >
        <i class="fas fa-arrow-circle-up"></i>
        <span class="font-jakarta">Data Pembelian</span>
       </a>
      </div>

      <div class="w-full">
       <a
        href="data_pengeluaran.html"
        class="flex items-center space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
       >
        <i class="fas fa-arrow-circle-down"></i>
        <span class="font-jakarta">Data Pengeluaran</span>
       </a>
      </div>
     </nav>
    </div>

    <div class="w-full border-t-2 border-secondary pt-4 mt-4">
     <div class="mb-2">Master Pegawai</div>
     <nav class="w-full">
      <div class="w-full">
       <a
        href="data_pegawai.html"
        class="flex items-center space-x-2 p-2 hover:bg-primary-hover transition rounded-md w-full"
       >
        <i class="fas fa-receipt"></i>
        <span class="font-jakarta">Data Pegawai</span>
       </a>
      </div>
     </nav>
    </div>

    <nav class="w-full pt-4">
     <a
      href="signin.html"
      class="flex items-center mt-4 space-x-2 p-2 bg-primary hover:bg-primary-hover transition rounded-md w-full"
     >
      <i class="fas fa-sign-out-alt text-secondary"></i>
      <span class="font-jakarta text-secondary">Sign Out</span>
     </a>
    </nav>
   </main>
  </div>

  <!-- Main content -->
  <div class="ml-0 md:ml-60 mt-[60px] p-5">
   <div class="flex items-center justify-between">
    <div class="flex flex-row space-x-2 items-center">
     <i class="fas fa-tags text-2xl"></i>
     <p class="text-xl font-bold">Data Kategori</p>
    </div>
    <div
     id="addKategoriBtn"
     class="flex items-center space-x-2 bg-primary text-white rounded-full py-3 px-5 cursor-pointer hover:bg-primary-hover transition duration-300"
    >
     <p class="font-semibold">Add</p>
     <i class="fas fa-plus"></i>
    </div>
   </div>

   <div class="flex items-center justify-center mb-2 mt-2">
    <input
     type="text"
     id="searchInput"
     placeholder="Cari..."
     class="w-full md:w-1/3 p-2 border border-gray-300 rounded-full focus:outline-none"
    />
   </div>

   <div class="overflow-x-auto rounded-lg shadow-lg">
    <table
     class="min-w-full text-sm border-0 border-gray-300 bg-white"
     id="kategoriTable"
    >
     <thead class="bg-primary text-white">
      <tr>
       <th class="px-4 py-2 text-center">No</th>
       <th class="px-4 py-2 text-center">Kode Kategori</th>
       <th class="px-4 py-2 text-center">Nama Kategori</th>
       <th class="px-4 py-2 text-center">Aksi</th>
      </tr>
     </thead>
     <tbody
      id="tableBody"
      class="text-gray-800 text-center divide-y divide-gray"
     ></tbody>
    </table>
   </div>
  </div>

  <!-- Modal Form Add Kategori -->
  <div
   id="formModal"
   class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden"
  >
   <div class="bg-white w-full max-w-md rounded-lg shadow-lg p-6">
    <h2 class="text-xl font-bold mb-4 text-primary">Kategori</h2>
    <form id="addKategoriForm" class="space-y-4">
     <div>
      <label class="block text-sm font-medium text-gray-700"
       >Kode Kategori</label
      >
      <input
       type="text"
       id="kodeKategori"
       class="mt-1 p-2 w-full border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
       required
      />
     </div>
     <div>
      <label class="block text-sm font-medium text-gray-700"
       >Nama Kategori</label
      >
      <input
       type="text"
       id="namaKategori"
       class="mt-1 p-2 w-full border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
       required
      />
     </div>
     <div class="flex justify-end space-x-2 pt-4">
      <button
       type="button"
       id="cancelBtn"
       class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400 transition"
      >
       Batal
      </button>
      <button
       type="submit"
       class="px-4 py-2 bg-primary text-white rounded hover:bg-primary-hover transition"
      >
       Simpan
      </button>
     </div>
    </form>
   </div>
  </div>

  <script>
   let isEditMode = false;
   let editIdKategori = null;

   const tableBody = document.getElementById("tableBody");
   const addKategoriBtn = document.getElementById("addKategoriBtn");
   const formModal = document.getElementById("formModal");
   const addKategoriForm = document.getElementById("addKategoriForm");
   const cancelBtn = document.getElementById("cancelBtn");
   const searchInput = document.getElementById("searchInput");

   // Load data kategori dari backend
   async function loadKategori() {
    try {
     const res = await fetch("http://localhost:3000/api/kategori");
     const data = await res.json();
     renderTable(data);
    } catch (error) {
     console.error("Error loading kategori:", error);
    }
   }

   // Render tabel kategori
   function renderTable(data) {
    tableBody.innerHTML = "";
    data.forEach((item, index) => {
     const tr = document.createElement("tr");
     tr.innerHTML = `
        <td class="px-4 py-2">${index + 1}</td>
        <td class="px-4 py-2">${item.kode_kategori}</td>
        <td class="px-4 py-2">${item.nama_kategori}</td>
        <td class="px-1 py-2 flex justify-center space-x-2">
          <button class="text-yellow-400 hover:text-yellow-700 text-xl" onclick="updateKategori('${
           item.kode_kategori
          }')"><i class="fas fa-edit"></i></button>
          <button class="text-red-400 hover:text-red-700 text-xl" onclick="deleteKategori('${
           item.kode_kategori
          }')"><i class="fas fa-trash"></i></button>
        </td>
      `;
     tableBody.appendChild(tr);
    });
   }

   // Show modal tambah kategori
   addKategoriBtn.addEventListener("click", () => {
    formModal.classList.remove("hidden");
    isEditMode = false;
    editIdKategori = null;
   });

   // Cancel modal
   cancelBtn.addEventListener("click", () => {
    formModal.classList.add("hidden");
    addKategoriForm.reset();
    isEditMode = false;
    editIdKategori = null;
   });

   // Submit form tambah kategori
   addKategoriForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const kodeKategori = document.getElementById("kodeKategori").value.trim();
    const namaKategori = document.getElementById("namaKategori").value.trim();

    try {
     let res;
     if (isEditMode) {
      // Jika sedang edit, gunakan PUT
      res = await fetch(
       `http://localhost:3000/api/kategori/${editIdKategori}`,
       {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
         kodeKategori,
         namaKategori,
        }),
       }
      );
     } else {
      // Jika tambah baru, gunakan POST
      res = await fetch("http://localhost:3000/api/kategori", {
       method: "POST",
       headers: { "Content-Type": "application/json" },
       body: JSON.stringify({
        kodeKategori,
        namaKategori,
       }),
      });
     }

     const data = await res.json();
     if (!res.ok) {
      alert(data.message || "Gagal menambah kategori");
      return;
     }

     alert(data.message);
     addKategoriForm.reset();
     formModal.classList.add("hidden");
     loadKategori(); // reload tabel
    } catch (error) {
     alert("Error menambah kategori");
     console.error(error);
    }
   });

   // Fitur Search
   document
    .getElementById("searchInput")
    .addEventListener("input", function () {
     const query = this.value.toLowerCase();
     const rows = document.querySelectorAll("#kategoriTable tbody tr");
     rows.forEach((row) => {
      const nama = row.children[2].textContent.toLowerCase(); // index ke-2 adalah 'Nama Kategori'
      row.style.display = nama.includes(query) ? "" : "none";
     });
    });

   // Fitur delete
   async function deleteKategori(id) {
    const konfirmasi = confirm(
     "Apakah kamu yakin ingin menghapus kategori ini?"
    );
    if (!konfirmasi) return;

    try {
     const res = await fetch(`http://localhost:3000/api/kategori/${id}`, {
      method: "DELETE",
     });

     const data = await res.json();
     if (!res.ok) {
      alert(data.message || "Gagal menghapus kategori");
      return;
     }

     alert(data.message);
     loadKategori(); // reload tabel
    } catch (error) {
     console.error("Error deleting kategori:", error);
     alert("Terjadi kesalahan saat menghapus kategori");
    }
   }

   // Load kategori saat pertama kali buka halaman
   loadKategori();

   // Fitur Update
   async function updateKategori(id) {
    try {
     const res = await fetch(`http://localhost:3000/api/kategori/${id}`);
     const data = await res.json();
     if (!res.ok) {
      alert(data.message || "Gagal mengambil data kategori");
      return;
     }
     // Isi form modal dengan data yang didapat
     document.getElementById("kodeKategori").value = data.kode_kategori;
     document.getElementById("namaKategori").value = data.nama_kategori;

     // Simpan id kategori yang sedang diedit dan ubah mode
     isEditMode = true;
     editIdKategori = id;

     // Tampilkan modal
     formModal.classList.remove("hidden");
    } catch (error) {
     alert("Error mengambil data kategori");
     console.error(error);
    }
   }

   // Script untuk toggle menu dashboard mobile
   document.addEventListener("DOMContentLoaded", function () {
    const menuDashboard = document.getElementById("menuDashboard");
    const mobileDashboard = document.getElementById("mobileDashboard");

    if (menuDashboard && mobileDashboard) {
     menuDashboard.addEventListener("click", function (event) {
      event.stopPropagation();
      mobileDashboard.classList.toggle("translate-x-full");
     });

     // Klik di luar menu nutup menu
     document.addEventListener("click", function (event) {
      if (
       !menuDashboard.contains(event.target) &&
       !mobileDashboard.contains(event.target)
      ) {
       if (!mobileDashboard.classList.contains("translate-x-full")) {
        mobileDashboard.classList.add("translate-x-full");
       }
      }
     });

     // Biar klik di dalam menu nggak nutup
     mobileDashboard.addEventListener("click", function (event) {
      event.stopPropagation();
     });
    }
   });
  </script>
 </body>
</html>
